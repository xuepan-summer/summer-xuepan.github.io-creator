---
title: "代码重构感想总结"
date: 2020-12-31T16:35:56+08:00
draft: false
---

做项目的过程中自己负责的模块传参很多，sonar也会不断报错参数超过七个，提示最好缩减到七个以内，所以在写代码的时候就稍微注意一些，争取在写代码的过程中就重构一下，使代码更加通俗易懂。

以下是总结出来的代码重构需要注意的问题，后续再多多补充：

1.命名参数和方法名时，争取一看到就知道参数是什么含义，方法到底做了什么

2.争取一个方法只做一件事情

eg:整个流程分为 判断是否符合前置条件--插入到中间表--处理符合条件的票

所以分成三步

具体实现中：

①所有对前置条件的处理放在一个方法里，里面可以再细分

可以复用方法，减少代码，如果还需后续处理，那么可以采用**lambda表达式**

②插入数据至中间表放在一个方法里

可以采用CollectionUtils.isEmpty()/isNotEmpty()等工具类里的方法

整个流程不要有大块的分支，if每多一层，复杂度就越高。例如不推荐一个很大的if块，可以采用反面，不符合条件就直接return
```
if (CollectionUtils.isEmpty(effectiveTax)) {
    return;
}
```
**不推荐使用非!**，特别不方便理解，而且带非的和&& || 这些一结合，还有执行先后顺序的问题

将带非的逻辑转换一下就行，实在不行将这部分抽取成一个方法

③处理符合条件的票放在一个方法里

3.双层for循环或者更多层的for循环，最好减少循环次数

当时双层for循环在debug的时候发现了问题，生成了两条TDS记录，是因为第一次for循环是对中间表中所有符合条件的数据进行循环，第二次循环是根据seq进行判断，有两个seq，所以循环了两次，所以生成了两条
双层for循环最好修改成for+for

4.**最好不要使用匿名内部类**，因为一旦出现问题，不方便查找

5.传递参数过多时：

看看每个参数都是在方法里面哪部分用的，然后**分类放在一起**，看看能不能根据参数把方法再抽取一下；还可以采用provider、entity、vo等来简化参数

6.复用已有方法，需要进行部分修改的时候，**一定要查看该方法的调用**，避免因为自己的修改导致其他功能受到影响